
// modified from W.R. Stevens example, server/client.c
//
// To build:
// gcc -o client client_multiprocess.c common.c
// (i.e., common.c has the common functions used in this file)

#include "common.h"
#include <unistd.h>
#include <stdlib.h>
#include <netdb.h>
#include <arpa/inet.h>
#include <errno.h>
#include <stdio.h>
#include <string.h>

char * text = " This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.This section provides definitions for terms that have a specific meaning to the OSPF protocol and that are used throughout thetext.  The reader unfamiliar with the Internet Protocol Suite ireferred to [Ref13] for an introduction to IP.called a gateway in much of the IP literature.common routing protocol.  Abbreviated as AS.System has a single IGP.  Separate Autonomous Systems may berunning different IGPs.A 32-bit number assigned to each router running the OSPF protocol.  This number uniquely identifies the router withinan Autonomous System.";


int main(int argc, char **argv)
{
	int		i, j, fd, nchildren, nloops, nbytes;
	pid_t	pid;
	ssize_t	n;
	char	request[MAXLINE], reply[MAXN];

	if (argc != 6) {
		fprintf(stderr, "usage: client <hostname or IPaddr> <port> <#children> "
				 "<#loops/child> <#bytes/request>");
		return -1;
	}

	nchildren = atoi(argv[3]);
	nloops = atoi(argv[4]);
	//nbytes = atoi(argv[5]);
	//snprintf(request, sizeof(request), "%d\n", nbytes); /* newline at end */

////////////////////
// Get Request
	//sprintf(request, "GET /%s HTTP/1.1\r\nHost: %s\r\nIam: aymannedaa\r\n\r\n",argv[5],"127.0.0.1");
///////////////////

////////////////////
// PUT Request
	sprintf(request, "PUT /%s HTTP/1.1\r\nHost: %s\r\nIam: aymannedaa\r\n\r\n%s\r\n\r\n",argv[5],"127.0.0.1",text);
///////////////////


///////////////////
// POST Request
//	char * website= argv[5];
//sprintf(request, "POST /dns-query HTTP/1.1\r\nHost: %s\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: %d\r\nIam: aymannedaa\r\n\r\nName=%s&Type=A\r\n\r\n","127.0.0.1",strlen(website)+12,website);
//////////////////
printf("%s\n",request);

	for (i = 0; i < nchildren; i++) {
		if ( (pid = fork()) == 0) {		/* child */
			for (j = 0; j < nloops; j++) {
				fd = tcp_connect(argv[1], argv[2]);
				if (fd < 0) {
				  perror("tcp_connect");
				  return -1;
				}

				if (write(fd, request, strlen(request)) < 0) {
					perror("write");
					return -1;
				}

			//	if ( (n = readn(fd, reply, nbytes)) != nbytes) {
		//			if (n < 0) {
		//				perror("readn");
		//				return -1;
		//			}
		//			fprintf(stderr, 
		//				"server returned %d bytes",
		//				(int)n);
		//			return -1;
		//		}

	if ( readn(fd, reply, sizeof(reply)) < 0)
	{ perror("read error");
	}
		printf("%s\n",reply);

				close(fd);		/* TIME_WAIT on client, not server */
			}
			printf("child %d done\n", i);
			exit(0);
		}
		/* parent loops around to fork() again */
	}

	while (wait(NULL) > 0)	/* now parent waits for all children */
		;
	if (errno != ECHILD) {
		perror("wait error");
		return 1;
	}

	return 0;
}
